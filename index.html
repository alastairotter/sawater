<script>

//window.location = "index_m.html";

</script>
<!DOCTYPE html>
<html lang="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="stylesheet" href="lib/font-awesome-4.6.3/css/font-awesome.css">
<!--    <link href="https://fonts.googleapis.com/css?family=Merriweather|Open+Sans" rel="stylesheet">-->
    <link href="https://fonts.googleapis.com/css?family=Libre+Franklin:400,700|Slabo+27px" rel="stylesheet">
<!--    <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:300,400,700" rel="stylesheet">-->
<!--    <link href="https://fonts.googleapis.com/css?family=Abril+Fatface" rel="stylesheet">-->
<!--    <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700" rel="stylesheet">-->
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700,900" rel="stylesheet">

<!--    <link type="text/css" href="https://cdn.jotfor.ms/before-after/before-after.min.css" rel="stylesheet">-->


    <link rel="stylesheet" href="lib/leaflet/leaflet.css">
    <script src="lib/leaflet/leaflet.js"></script>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="styles_rain.css">
    <link rel="stylesheet" href="styles_dams.css">
    <link rel="stylesheet" href="styles_keydams.css">
    <link rel="stylesheet" href="styles_map.css">
    <script src="data/top_ten_dams_json.js"></script>
    <script src="data/alldams_ages.json"></script>
    <script src="data/drainageareas.js"></script>
    <script src="data/wc_dams.json"></script>
    <script src="data/wc_drainage.js"></script>
    <script src="data/sa.json"></script>
    <script src="lib/d3.v3.min.js"></script>
    <script src="liquidFillGauge.js"></script>
    <script src="lib/queue.v1.min.js"></script>
    <script src="lib/jquery.min.js"></script>
    <script src="cookie.js"></script>


<meta property="og:url"                content="http://mediahack.co.za/work/water" />
<meta property="og:type"               content="article" />
<meta property="og:title"              content="Interactive: South Africa's Water Challenge" />
<meta property="og:description"        content="South Africa is a water-scarce country and relies heavily on network of dams during the dry season. In the first part of this series we look at the country's water supply infrastructure." />
<meta property="og:image"              content="http://mediahack.co.za/work/water/images/january_2017_fb2.jpeg" />


</head>

<body>

<div class="splash">
    <b>Viewing this on a mobile device?</b><br />
    Some of the interactive features may not work as expected. Sorry about that and believe us when we say that it pains us as much as it does you. If we can fix these problems we will, so scroll down to the bottom and get in touch with your suggestions. Click the tick below to remove this warning. <br />
    <i class="fa fa-check-circle check" aria-hidden="true"></i>


</div>
<!--
<script>
    document.write(window.innerWidth);
    console.log(window.innerWidth);
    </script>
-->
<div class="tooltip">Tooltip</div>
<div class="tooltip2">Tooltip</div>

<!--    <div class="info">&nbsp;</div>-->

    <div class="info-pane-share">
    <div class="addthis_inline_share_toolbox"></div>

     </div>

<div class="main-title">
 South Africa's Water Challenge


</div>


    <div class="mainblurb"><span class="blurb-part">PART 1</span><br />Water Storage Infrastructure </div>
     <div class="info-pane">research & programming: <span class="bold"><a href="http://twitter.com/alastairotter">alastair otter &nbsp; <i class="fa fa-twitter" aria-hidden="true"></i></a></span><br />
         a <span class="bold"><a href="http://mediahack.co.za">media hack collective</a></span> project</div>



<div class="maincontainer">

<div class="content-box">
<!--   <div class="content-title">Scarce Resource</div>-->
   <p>
       Over the past few years South Africa has been experiencing one of the most extreme droughts in recent history. Many experts  consider the dry season of 2015/2016 <a href="https://africacheck.org/2016/02/03/frequently-asked-questions-about-south-africas-drought/">to be the worst drought in almost 25 years</a>, but the 2016/2017 dry season looks likely to be rated even worse. During the 2016/2017 dry season dam levels in most provinces dropped below those of 2015/2016 and some provinces, such as the Western Cape, are still firmly in the grip of the drought.

   </p>
   <p>One of the major causes of the extreme droughts over the past few years has been the impact of El Niño, a weather phenomenon in which the water surface temperature in the eastern pacific is warmer than usual, causing warmer, drier temperatures in South Africa. </p>
   <p>El Niño is a cyclical weather phenomenon and so will eventually make way for La Niña, with the opposite effect of El Niño. And while that will bring some relief for the country, it doesn't change the fact that South Africa is a water-scarce country which is extremely vulnerable to climate events. </p>

   <p style="font-style: italic;">This is part one of a planned series on South Africa's water supply management and strategy. Here we will look at the country's water infrastructure and some of the effects of the recent drought.  </p>

   <div class="content-title">Planning for scarcity</div>

    <p>South Africa is a water-scarce country with annual rainfall well below the world average. According to the World Bank's database of <a href="http://data.worldbank.org/indicator/AG.LND.PRCP.MM">annual global rainfall averages</a> South Africa receives an average of just 495mm of rain a year. This is almost half of the global average of 990mm and significantly less than the rain received by Colombia which tops the list at 3,240mm a year.



                </p>
                <div id="rainfall"></div>

<!--    <div id="contribution"></div>-->

</div>

<div class="content-box">
<!--    <div class="content-title">Saving For Lean Times</div>-->
    <p>Receiving so little rain South Africa is heavily reliant on its ability to capture and store water for leaner times. It does this by maintaining a network of storage dams and reservoirs across the county. The Department of Water and Sanitation manages a total of 210 dams that make up the backbone of the country's water management strategy.</p>
    <p>The majority of these dams are located in the Eastern and Western Cape but it is the larger dams in provinces such as the Free State that play the biggest role in managing the water risk the country faces.
    </p>
    <p>In the chart below each circle represents one of these 210 dams.  </p>

     <div id="dams">
      <div class="damnav">
        <div class="dam one">All dams</div>
        <div class="dam two">Sort by province</div>
        <div class="dam three">Sort by size</div>
        <div class="dam four">Top ten dams</div>
    </div>
    <div class='dams1'></div>

  </div>

   <p>Of the 210 dams it is just a handful that make up the bulk of South Africa's water storage capacity. In the chart below we can see that the five largest dams account for almost 50% of the country's total storage capacity. Their individual contribution to overall storage is also indicated. The other 205 dams account for the remaining 50%.

                </p>
       <div id="keydams"></div>

</div>
<!--

<div class="content-box">
    <div class="content-title">A brief history</div>


<p>Looking at the country’s largest dams they range between 78 (Vaal dam) and 15 (Mohale dam) years of age:
<ol>
    <li>Gariep Dam: 46 years old </li>
<li>Vanderkloof Dam: 40 years old</li>
<li>Sterkfontein Dam: 37 years old</li>
<li>Vaal Dam: 78 years old</li>
<li>Pongolapoort Dam: 44 years old</li>
<li>Katse Dam: 21 years old</li>
<li>Bloemhof Dam: 47 years old</li>
<li>Mohale Dam: 15 years old</li>
<li>Theewaterskloof Dam: 39 years old</li>
<li>Heyshope Dam: 34 years old</li>
       </ol></p>

</div>
-->





<div class="content-box">
   <div class="content-title">The State of Dam Storage: November 2015 to February 2017</div>

    <p>As part of its monitoring processes the Department of Water and Sanitation releases weekly data on the levels of all listed dams in South Africa. Looking through this data it is possible to build a picture of how the drought rolled through the country. The charts below represent the provincial levels for dams in November 2015, November 2016 and February 2017 (collected 27 February 2017).</p>



<div class="gauge-controls gc-top">

                    <div class="National pgc"><input class="gc" type="checkbox" id="gc" name="National" checked> National </div>
                    <div class="Eastern Cape pgc"><input class="gc" type="checkbox" id="gc" name="Eastern Cape"> Eastern Cape </div>
                    <div class="Free State pgc"><input class="gc" type="checkbox" id="gc" name="Free State"> Free State </div>
                    <div class="Gauteng pgc"><input class="gc" type="checkbox" id="gc" name="Gauteng"> Gauteng </div>
                    <div class="KwaZulu-Natal pgc"><input class="gc" type="checkbox" id="gc" name="KwaZulu-Natal"> KwaZulu-Natal </div>
                    <div class="Limpopo pgc"><input class="gc" type="checkbox" id="gc" name="Limpopo"> Limpopo </div>
                    <div class="Mpumalanga pgc"><input class="gc" type="checkbox" id="gc" name="Mpumalanga"> Mpumalanga </div>
                    <div class="North West pgc"><input class="gc" type="checkbox" id="gc" name="North West"> North West </div>
                    <div class="Northern Cape pgc"><input class="gc" type="checkbox" id="gc" name="Northern Cape"> Northern Cape </div>
                    <div class="Western Cape pgc"><input class="gc" type="checkbox" id="gc" name="Western Cape"> Western Cape </div>
                    <div class="Lesotho pgc"><input class="gc" type="checkbox" id="gc" name="Lesotho"> Lesotho</div>


                </div>


    <div class="gauge-holder">




  <svg id="fillgauge1" width="30%" height="200"></svg>
  <svg id="fillgauge2" width="30%" height="200"></svg>
  <svg id="fillgauge3" width="30%" height="200"></svg>


  <div class="gauge-controls gc-bottom">

                    <div class="National pgc2"><input class="gc" type="checkbox" id="gc" name="National" checked> National</div>
                    <div class="Eastern Cape pgc2"><input class="gc" type="checkbox" id="gc" name="Eastern Cape"> Eastern Cape</div>
                    <div class="Free State pgc2"><input class="gc" type="checkbox" id="gc" name="Free State"> Free State</div>
                    <div class="Gauteng pgc2"><input class="gc" type="checkbox" id="gc" name="Gauteng"> Gauteng</div>
                    <div class="KwaZulu-Natal pgc2"><input class="gc" type="checkbox" id="gc" name="KwaZulu-Natal"> KwaZulu-Natal</div>
                    <div class="Limpopo pgc2"><input class="gc" type="checkbox" id="gc" name="Limpopo"> Limpopo</div>
                    <div class="Mpumalanga pgc2"><input class="gc" type="checkbox" id="gc" name="Mpumalanga"> Mpumalanga</div>
                    <div class="North West pgc2"><input class="gc" type="checkbox" id="gc" name="North West"> North West</div>
                    <div class="Northern Cape pgc2"><input class="gc" type="checkbox" id="gc" name="Northern Cape"> Northern Cape</div>
                    <div class="Western Cape pgc2"><input class="gc" type="checkbox" id="gc" name="Western Cape"> Western Cape</div>
                    <div class="Lesotho pgc2"><input class="gc" type="checkbox" id="gc" name="Lesotho"> Lesotho</div>


                </div>

</div>





<div style="clear: both;"></div>

</div>

 <div class="content-box">


     <p style="font-style: italic;"><span style="font-weight: bold;">Note:</span> These are water levels for dams located in each province, not necessarily the amount of water available to a province. Gauteng, for example, receives the bulk of its water from the Free State. The Vaal dam is in the Free State administration area. So while Gauteng's dams were relatively full throughout the drought, it suffered from the depleted Free State dams.</p>


<p>As you can see from the state of dam storage chart, the 2016/2017 drought season initially affected the inland and more northern provinces. The worst of the drought season for most of those provinces was between November and December 2016. Limpopo and Mpumalanga dam levels were down between 22 and 26% compared with November 2015 and the Free State dams were down 17% compared to the previous year. The low levels of these dams affected not only the province they were located in but also had a major impact on the metropolitan areas in Gauteng. By mid-November 2016 the Vaal dam, the key supplier of water to Gauteng cities, was perilously low at 26% of its full storage capacity.</p>

    <p>On 7 November 2016 water authorities began to release water from the Sterkfontein dam to begin replenishing the Vaal dam. At the time the Sterkfontein dam in the Free State was almost 90% full.  </p>

     <p>Strong rains, and even floods, in the latter months of 2016 and early 2017 have now replenished the major Free State dams and some have even exceeded their full capacity. On 26 February 2017 <a href="http://www.enca.com/south-africa/vaal-dams-sluice-gates-opened">sluice gates at the Vaal dam were opened and a flood warning was issued</a> to residents in the area as the dam reached full capacity. </p>

     <p>Further south, the Western Cape is still in the grip of drought. In November 2016 the province's dams were lower than the same time the previous year but not by as much as those in many other provinces. Western Cape dams were down 9% in November 2016 compared with November 2015. Free State dams, in comparison, were down almost double that at 17% for the same period. </p>

      <p>By February, however, the situation was significantly reversed. While the upcountry dams were largely replenished, the Western Cape dams continued to fall. At the time of writing (3 March 2017), Western Cape dam levels were down to just 33% of their storage capacity, almost half of what they were in November 2016 and a third of what they were in November 2015. </p>
       <p>
      The province's largest dam, Theewaterskloof, which accounts for more than 25% of the Western Cape's total water storage now sits at 27%, down from 42% last year. </p>








    </div>

    <div class="content-box">

    <p>


    <div class="slider">
    <div class="content-title" style="margin-bottom: 10px;">Theewaterskloof Dam</div>
<iframe frameborder="0" class="juxtapose" width="100%" height="773" src="https://cdn.knightlab.com/libs/juxtapose/latest/embed/index.html?uid=c5242692-00c9-11e7-940c-0edaf8f81e27"></iframe>
   <span style="font-style: italic;">Photos: Greg Gordon</span>
    </div>

      <script>
        var slider = $(".slider").width();
        $(".juxtapose").height(slider * 0.52);
        </script>

       <div class="static">
            <div class="static-title">Theewaterskloof Dam July 2014</div>
           <img src="slider/jul2014_new.jpeg" style="width: 100%;">
           <div class="static-title">Theewaterskloof Dam January 2017</div>
           <img src="slider/jan2017_new.jpeg" style="width: 100%;">
          <span style="font-style: italic;">Photos: Greg Gordon</span>
       </div>


        </p>



    </div>






<!--
   <div class="content-title">
       Section title
   </div>
-->

<!--  <div class="content-box-trans trans2"></div>-->


   <div class="content-box">

       <div class="content-title">Extremes</div>
<p>
One of the features of the recent drought, particularly in the centre and the north of the country, was the relatively extreme weather conditions. In early November 2016, while the Vaal dam was nearing its lowest levels and water authorities were releasing water from Sterkfontein to supplement the dam, large parts of Gauteng experienced devastating flooding. And water restrictions remained in place well into the early part of 2017.
</p>
<p>The primary reason that parts of the country could have both water restrictions and floods at the same time is related to the various drainage areas (catchment areas) that serve each of the major dams. Looking at the Vaal dam for example:
 </p>
 <div style="100%; text-align: center;">
     <img src="drainage.png" style="max-width: 100%;">

 </div>
<p>The drainage region for the Vaal dam is the light pink area. Johannesburg sits on the very northern border of this catchment area, while Sandton and Pretoria sit north of the area. So while heavy rain over these areas might suggest an improvement in the drought situation, the reality is that rains further south and south-west of Johannesburg and Gauteng are what really matter. </p>

       <p>Similarly, in the Western Cape the Theewaterskloof dam relies on good rainfall north of the Hottentots Holland mountain range for replenishment. So rain in the Cape Town city centre is not a reliable indicator of general improvement. Although, as you will see later, the province's other major dams are a lot closer to Cape Town than the Theewaterskloof dam.  </p>


   </div>






<!--
  <div class="content-box">
      <div class="content-title">Saving for Another Day</div>

      <div class="tooltip">Tooltip</div>
  <div id="dams">
      <div class="damnav">
        <div class="dam one">1</div>
        <div class="dam two">2</div>
        <div class="dam three">3</div>
        <div class="dam four">4</div>
    </div>
    <div class='dams1'></div>

  </div>
  <div style="clear: both;"></div>
  </div>


-->
  <div class="content-box">
      <div class="content-title">Catchment areas</div>

   South Africa is broadly divided into 22 "drainage" regions. They're labelled from A to X and broadly correspond to the countours of the land. The map below shows the ten largest dams in South Africa and their draingage areas. The Bloemhof, Vaal and Sterkfontein dams rely on good rains over most of the Free State. The Vanderkloof and the Gariep dams, the two largest in the country, are largely replenished by rains over the southern Free State, Northern Cape, north-western Eastern Cape and Lesotho.

    </div>




   <div class="content-box topdams">

       <div class="content-title small">South Africa's ten largest dams and their drainage areas</div>
       <div id="map" style="width: 100%; min-height: 200px;"></div>
   </div>

   <div class="content-box topdams-static">
        <div class="content-title small">South Africa's ten largest dams and their drainage areas</div>
        <img src="images/topten_new.jpg" width="100%" style="border: solid 1px gray;">
    </div>

   <div class="content-box">

   Looking further south the City of Cape Town's water supply system is built around six primary dams, the largest of which is the Theewaterskloof dam east of Cape Town. The Theewaterskloof dam is dependent on good rains in the Hottentots Holland catchment area while the other dams in the system are in the drainage zone around Cape Town. At the time of writing most of the dams in the Western Cape were between 32% and 38% of their full capacity. The Theewaterskloof dam was at 27%.

    </div>

    <div class="content-box wcdams">
       <div class="content-title small">Cape Town's water supply dams and their drainage areas</div>
        <div id="map2" style="width: 100%; min-height: 200px;"></div>
    </div>

    <div class="content-box wcdams-static">
        <div class="content-title small">Cape Town's water supply dams and their drainage areas</div>
        <img src="images/topwc_new.jpg" width="100%" style="border: solid 1px gray;">
    </div>


    <div class="content-box" style="font-style: italic;">
        <p>A complete water management system and strategy is a lot more than just the dams and the water they are able to hold. In either future versions of this particular piece, or in entirely new versions, I will look at other aspects of the water supply system.</p>

        <p>
            <span style="font-weight: 700;">Comments, thoughts, suggestions?</span><br/>
            The data for this piece was collected from various sources (see below). The interpretation of that data is entirely mine. Therefore, any errors or ommissions are mine. If you have a suggestion or a comment please let me know via <b><a href="mailto:alastair@mediahack.co.za">email</a></b> or via <b><a href="http://twitter.com/alastairotter">Twitter</a></b>.
        </p>

        <p><span style="font-weight: 700;">Mobile users:</span> If you're viewing this on a mobile device some of the interactive charts may not work exactly as expected. I have tried to make this compatible with as wide a range of devices as possible but some issues may still surface. Apologies for that.</p>

         <p>
            <span style="font-weight: 700;">Sources/credits</span><br/>
            <ul>
                <li>Annual rainfall averages: <a href="http://data.worldbank.org/indicator/AG.LND.PRCP.MM">World Bank</a></li>
                <li>Cover ostrich photo: <a href="https://pixabay.com/en/ostrich-south-africa-watering-place-629024/">Pixabay</a></li>
                <li>Theewaterskloof dam photos: Greg Gordon</li>
                <li>Dam levels, draingage areas: <a href="http://www.dwa.gov.za/hydrology/Weekly/Province.aspx">South African Department of Water and Santation</a></li>
                <li>Water level gauges: Based on <a href="http://bl.ocks.org/brattonc/5e5ce9beee483220e2f6">Curtis Bratton's work</a></li>

        </p>



    </div>


    <div class="content-box-trans trans1"></div>




    </div> <!-- Maincontainer end -->



<script>
    var damColors = ["#b9b6cb","#abd8bc","#e5a2af","#9dd0dc","#e6b8a6","#aebce5","#cac4a1","#dbb7e0","#e1e8d0","#ebb9c7","#e1daec","#d9c0c7"]

        var damtooltip;

        var tooltip = d3.selectAll(".tooltip")


        d3.csv("data/dam_levels_national.csv", function (stats) {



//

        var provinces = ['National','Gauteng','Free State','Western Cape','Eastern Cape','North West','Limpopo','Northern Cape','KwaZulu-Natal','Mpumalanga','Lesotho'];
        var provcode = ['N','GP','FS','WC','EC','NW','LP','NC','KZN'];

        function round(value, precision) {
            var multiplier = Math.pow(10, precision || 0);
            return Math.round(value * multiplier) / multiplier;
        }

        stats.forEach( function (d) {
            d.this_week = +round(d.this_week,1);
            d.last_week = +round(d.last_week,1);
            d.last_year = +round(d.last_year,1);
        })


        if(window.innerWidth < 400) {
            var windowWidth = window.innerWidth,
                windowHeight = window.innerHeight,
                gaugeWidth = 100,
                gaugeHeight = 100,
                gaugePadding = 10,
                center = windowWidth / 2;
        }
        else {
            var windowWidth = window.innerWidth,
                windowHeight = window.innerHeight,
                gaugeWidth = 170,
                gaugeHeight = 170,
                gaugePadding = 10,
                center = windowWidth / 2;

        }
//
        var svg = d3.select("#fillgauge1")
            .attr("height", gaugeHeight + 60)
            .attr("width", gaugeWidth)
            .style("padding-left","20px")
            .style("padding-right","20px")

        var svg = d3.select("#fillgauge2")
            .attr("height", gaugeHeight + 60)
            .attr("width", gaugeWidth)
            .style("padding-left","20px")
            .style("padding-right","20px")


        var svg = d3.select("#fillgauge3")
            .attr("height", gaugeHeight + 60)
            .attr("width", gaugeWidth)
            .style("padding-left","20px")
            .style("padding-right","20px")

        // DEFINE GUAGES
        var config4 = liquidFillGaugeDefaultSettings();
        config4.circleThickness = 0.05;
        config4.circleColor = "#eee";
        config4.textColor = "#545454";
        config4.waveTextColor = "#fff";
        config4.waveColor = "#64a2db";
        config4.textVertPosition = 0.2;
        config4.waveAnimateTime = 2000;
        config4.waveHeight = 0.05;
        config4.waveAnimate = true;
        config4.waveRise = true;
        config4.waveHeightScaling = false;
        config4.waveOffset = 0.25;
        config4.textSize = 0.45;
        config4.waveCount = 2;
        var gauge1 = loadLiquidFillGauge("fillgauge1", stats[10].last_year, config4);

         var config4 = liquidFillGaugeDefaultSettings();
        config4.circleThickness = 0.05;
        config4.circleColor = "#eee";
        config4.textColor = "#545454";
        config4.waveTextColor = "#fff";
        config4.waveColor = "#64a2db";
        config4.textVertPosition = 0.2;
        config4.waveAnimateTime = 2000;
        config4.waveHeight = 0.05;
        config4.waveAnimate = true;
        config4.waveRise = false;
        config4.waveHeightScaling = false;
        config4.waveOffset = 0.25;
        config4.textSize = 0.45;
        config4.waveCount = 2;
        var gauge2 = loadLiquidFillGauge("fillgauge2", stats[10].this_week, config4);


         var config4 = liquidFillGaugeDefaultSettings();
        config4.circleThickness = 0.05;
        config4.circleColor = "#eee";
        config4.textColor = "#545454";
        config4.waveTextColor = "#fff";
        config4.waveColor = "#64a2db";
        config4.textVertPosition = 0.2;
        config4.waveAnimateTime = 2000;
        config4.waveHeight = 0.05;
        config4.waveAnimate = true;
        config4.waveRise = false;
        config4.waveHeightScaling = false;
        config4.waveOffset = 0.25;
        config4.textSize = 0.45;
        config4.waveCount = 2;
        var gauge3 = loadLiquidFillGauge("fillgauge3", stats[10].feb, config4);

        //ADD GAUGE LABELS

        var g1 = d3.select("#fillgauge1").append("text").text("November 2015");
        var g2 = d3.select("#fillgauge2").append("text").text( function () { return "November 2016"; });
        var g3 = d3.select("#fillgauge3").append("text").text( function () { return "February 2017"; });

        g1.style("stroke","#545454").style("stroke-width","1").attr("class","labels").attr("y", gaugeHeight + 50).attr("x", gaugeWidth/2).style("text-anchor","middle")
        g2.style("stroke","#545454").style("stroke-width","1").attr("class","labels").attr("y", gaugeHeight + 50).attr("x", gaugeWidth/2).style("text-anchor","middle")
        g3.style("stroke","#545454").style("stroke-width","1").attr("class","labels").attr("y", gaugeHeight + 50).attr("x", gaugeWidth/2).style("text-anchor","middle")



        // GAUGE CONTROLS
        provinces.forEach( function (d) {
            d3.selectAll("[name='" + d +"']").on("change", function () {

                d3.selectAll(".gc").property('checked', false);
                d3.select(this).property('checked',true);
                  d3.selectAll(".pgc").style("font-weight", "normal")
                d3.select("[class='" + d + " pgc']").style("font-weight","700")
                var curStats = stats.filter( function (dd) {
                    return dd.province === d;
                })

            gauge1.update(curStats[0].last_year);
            gauge2.update(curStats[0].this_week);
            gauge3.update(curStats[0].feb);
            })
        })


            });


    </script>


    <!-- RAINFALL STATS -->
   <script>


    var tooltip2 = d3.select(".tooltip2");

    var margin = { top: 30, right: 0, bottom: 30, left: 5}

    if(window.innerWidth < 500) {

        var width = window.innerWidth - 5;
    }
       else { width = window.innerWidth- 100;
            }



    if(width > 800) width = 800;

    width = width - margin.left - margin.right - 50;


    var height = window.innerHeight * 0.6;
    if(window.innerWidth < window.innerHeight){
        var height = width * 0.6;
    }
    else  {
        var height = width * 0.4;

    }




    height = height - margin.top - margin.bottom;

    d3.select("#rainfall")
        .style("width", width + "px")

    var rain_svg = d3.select("#rainfall")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform","translate(" + margin.left + "," + margin.top + ")")

    var yrain = d3.scale.ordinal()
    .rangeBands([0, height], .5);

    var xrain = d3.scale.linear()
    .range([0,width]);

    var xAxis = d3.svg.axis()
        .scale(xrain)
        .orient("bottom");

    var yAxis = d3.svg.axis()
        .scale(yrain)
        .orient("left")
//        .tickFormat(formatPercent);

    d3.csv("data/rainfall_new.csv", function (rainfall) {

        rainfall.forEach( function (d) {
            d.rain = +d.rain;
        })

        var sarain = rainfall.filter( function (d) { return d.country_code === "za"; })

        var rain_top = rainfall.slice(0, 20);
        rain_top[20] = sarain[0];
        var rain_bottom = rainfall.slice(Math.max(rainfall.length - 20, 1));
        rain_bottom[20] = sarain[0];


        yrain.domain(rainfall.map(function(d) { return d.country; }));
        xrain.domain([0, d3.max(rainfall, function(d) { return d.rain; })]);



//  rain_svg.append("g")
//      .attr("class", "y axis")
//      .call(yAxis)


  rain_svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis);


  rain_svg.append("text")
    .attr("y", -10)
    .text("Average annual rainfall per country (mm)")


  rain_svg.selectAll(".bar")
      .data(rainfall)
    .enter().append("rect")
  .attr("class", function (d) { return d.country_code; })
      .classed("bar", true)
      .attr("x", 0)
        .attr("y", function(d) { return yrain(d.country); })
      .attr("height", yrain.rangeBand())
      .attr("width", function(d) { return xrain(d.rain); })
        .on("mouseover", function (d) {

            var tipText = d.country + "<br />" + d.rain + "mm";
            tooltip2.style("display", "block")
                .style("top", d3.event.pageY - 10 + "px")
                .style("left", d3.event.pageX + 25 + "px")
                .html(tipText);


//            console.log($("#rainfall").position())
;        })
        .on("mouseout", function () {
            tooltip2.style("display", "none")
        })

  // ADD WORLD AVERAGE

//  d3.select(".world")
//    .transition()
//    .duration(2000)
//    .attr("width", width)


  // ADD LABELS
//   var wrld_av_label = rain_svg.append("text")
//    .text("World Average: 990 mm/year")
//    .attr("x", width/2)
//    .attr("y", height/2 - 3)
//    .attr("class", "av_label")


  var wrld_av_label = rain_svg.append("text")
    .text("World Average: 990 mm/year")
    .attr("x", function () {
        var w = d3.select(".world").attr("width");


       w = +w + 10;

       return w;
    })
    .attr("y", function () {
        var w = d3.select(".world").attr("y");
       w = +w + 5;
       return w;


    })
   .attr("class", "av_label")


   var sa_av_label = rain_svg.append("text")
    .text("South Africa: 495 mm/year")
    .attr("x", function () {
        var sa = d3.select(".za").attr("width");


       sa = +sa + 10;

       return sa;
    })
    .attr("y", function () {
        var sa = d3.select(".za").attr("y");
       sa = +sa + 5;
       return sa;


    })
   .attr("class", "av_label")

   })


    </script>
    <!-- END RAINFALL STATS -->



    <!-- DAMS STATS -->
    <script>



         var colors = ["#93d8a5",
"#e9acd3",
"#64dcd8",
"#eead84",
"#8ad1e9",
"#c4c381",
"#b6bde5",
"#e0ebaa",
"#dfc3b3",
"#b2d5c3"];


      var width = $("#dams").width();



      var dams_svg = d3.select("#dams")
        .append("svg")
        .attr("width", width)


      var format = d3.format(',');



      var annotation = dams_svg.append("g");




      function main(error, dams, provinces, dams_by_size, dams_by_alpha) {



            provinces.forEach( function (d) {
                d.fsc = +d.fsc;
            })

            var provincesNoTotal = provinces.filter( function (d) { return d.province !== "Total"; })



            dams.forEach( function (d) {
                d.FSC = +d.FSC;
            })

            var damsTotal = dams.filter( function (d) { return d.Dam == "Total"; })

            var damsNoTotal = dams.filter( function (d) { return d.Dam !== "Total"; })


            if(width < 800) { var radius = 7; }
            else { var radius = 10; }




            var circlemargin = 3,
                    damcount = 210,
//                    colcount = (width / (radius * 2 + circlemargin)).toFixed(0),
                    colcount = ((width - (radius * 2)) / (radius * 2 + circlemargin)).toFixed(0),
                    rowcount = ((damcount / colcount) + 1).toFixed(0),
                    xpos = 1,
                    ypos = 1,
                    yoffset = 0,
                    xoffset = 15;




          dams_svg.attr("height", function () {
              return rowcount * (radius * 4 + (circlemargin * 2)) + yoffset;
            })

        function resizeDamBox () {

            // GET DAMS1 HEIGHT
            var damheight = $(".dams1").height();



              d3.select("#dams")
                    .style("height", function (){
                        return rowcount * (radius * 3 + circlemargin) + yoffset + damheight;

                })

        }

          resizeDamBox();


            function add_dams() {
                 dams_alpha_no_total = dams_by_alpha.filter( function (d) { return d.Dam !== "Total"; })


                dams_alpha_no_total.forEach( function (d) {
                    d.rowc = + d.rowc;
                    d.Dam = (d.Dam).replace("Dam","");
                    })



                var dams = dams_svg.append("g")



                var xpos = 1,
                    ypos = 1;

                dams_alpha_no_total.forEach( function (d, i) {

                    d.ypos = (function () {
                        return ypos;

                    })();

                    d.xpos = (function () {
                        var newx = xpos;
                        xpos = xpos + 1;
                        if(xpos == colcount) { xpos = 1; ypos = ypos + 1; }
                        return newx;
                    })();



                })



                dams_alpha_no_total.forEach( function (d) {

                    dams.append("circle")
                        .attr("cx", function () { return d.xpos * (radius * 2 + circlemargin); })
                        .attr("cy", function () { return d.ypos * (radius *2 + circlemargin) + yoffset; })
                        .attr("r", radius)
                    .attr("class", "droplet")
                        .style("fill", "#eee")

                        .style("stroke", "#a5a5a5")
                        .style("stroke-width", 1)


                        .on("mouseover", function () {

                            tooltip.style("visibility","visible")

                            var coordinates = d3.mouse(dams_svg.node());


//                            d3.select(this).style("fill", "crimson")
                        })
                        .on("mousemove", function () {



                            var tip = "<div style='font-weight: 700; text-transform:uppercase;'>" + d.Dam + "</div>";
                            tip += format(d.FSC) + " million m<sup>3</sup>";
                            tooltip.html(tip)
                            .style("left", (d3.event.pageX + 35) + "px")
                            .style("top", (d3.event.pageY - 12) + "px");
//


                        })
                        .on("mouseout", function () {
                            tooltip.style("visibility", "hidden")
//
                        })

                })




                d3.select(".dams1").html("Capturing and storing what little rain South Africa does receive is key in the country's water management strategy. To this end there are 210 listed storage dams that make up a total potential storage of " + format(damsTotal[0].FSC) + " million cubic meters.")


                resizeDamBox();

            }

            add_dams();




          function dams2() {

                annotation.remove();

                 dams_svg.selectAll(".droplet")
                    .data(damsNoTotal)
                    .on("mouseover", function (d) {



                        var tip = "<div style='font-weight: 700; text-transform:uppercase;'>" + d.Province + "<br/><span style='text-transform:none;'>" + d.Dam + "</span></div>";

                        tip += format(d.FSC) + " million m<sup>3</sup>";



                        tooltip.style("visibility","visible")
                            .html(tip)
                                .style("left", (d3.event.pageX + 20) + "px")
                                .style("top", (d3.event.pageY - 20) + "px");
//                    .style("background",contColors[i])



                    })
                    .on("mouseout", function () {
                        return tooltip.style("visibility","hidden")
                    })
                    .on("mousemove", function (d,i) {

//                        tooltip.style("x", d3.mouse(this)[0] + ttoffsetx)
//                            .style("y", d3.mouse(this)[1] + ttoffsety)

                    })
                    .transition()
                    .duration( function (d,i) {
                        return i * 10;
                    })
                    .style("fill", function (d)  {
                        return colors[d.Province_Index];
                    })
                    .style("opacity", 1)


                 // CREATE PROVINCE LEGEND
                 var provinces = [];
                 var marker;

                 damsNoTotal.forEach( function (d) {

                     if(d.Province_Index !== marker) {
                         provinces.push( {
                            province: d.Province,
                             province_code: d.Province_Code,
                             province_index: d.Province_Index
                         } )

                     marker = d.Province_Index;
                     }

                 })


                dams_svg.selectAll(".provlegend")
                    .data(provinces)
                    .enter()
                    .append("circle")
                    .attr("cx", function (d,i) {
                        if(i < 5) {
                            return i * 50 + xoffset +5;
                        }
                        else {
                            i = i - 5;
                            return i * 50 + xoffset +5;
                        }
                    })
                    .attr("cy", function (d,i) {
                        if(i < 5) {
                            return rowcount * (radius * 2.6 + circlemargin);
                        }
                        else {
                            return rowcount * (radius * 3 + circlemargin);

                        }
                    })
                    .attr("r", 6)
                    .attr("class", "legends")
                    .style("fill", function (d) {
                        return colors[d.province_index];
                    })

                dams_svg.selectAll(".provlegendtext")
                    .data(provinces)
                    .enter()
                    .append("text")
                        .attr("x", function (d,i) {
                           if(i < 5) {
                            return i * 50 + xoffset +17;
                        }
                        else {
                            i = i - 5;
                            return i * 50 + xoffset +17;
                        }
                        })
                        .attr("y", function (d, i) {
                            if(i < 5) {
                            return rowcount * (radius * 2.6 + circlemargin) + 5;
                        }
                        else {
                            return rowcount * (radius * 3 + circlemargin) + 5;

                        }
                        })
                        .text( function (d) {
                            return d.province_code;
                        })
//                        .style("fill", function (d) {
//                            return colors[d.province_index];
//                        })

                        .style("stroke-width", 1)
                        .attr("class", "provlegendtext")





                 d3.selectAll(".dams1")
                    .html("The majority of South Africa's dams are located in the Eastern and Western Cape (86 of the 210 dams). North West, Limpopo and Mpumalanga each have more than 20 dams. ")

            }


            function dams3() {

                annotation.remove();


                dams_svg.selectAll(".droplet")
                    .data(dams_by_size)
                    .transition()

                    .duration(1000)

                    .style("fill", function (d)  {
                        return colors[d.Province_Index];
                    })
                    .style("opacity", 1)








                    d3.selectAll(".dams1")
                    .html("Five of SA's largest ten dams are in the Free State")

            }



            function dams4() {


                // ANNOTATIONS

//                annotation = dams_svg.append("g")
//
//
                d3.selectAll(".droplet").transition()
                    .duration(1000)
                    .style("opacity", function (d) {

                        if(d.rowc == 0 && d.xpos < 10) {
                            return 1;
                        }
                        else {
                            return 0.1;
                        }
                    })

            }



            d3.select(".one").style("background", "#000").style("color", "#fff")

            d3.select(".two")
                .on("click", function () {
                    d3.selectAll(".dam").style("background", "#fff").style("color", "#000")
                    d3.select(this).style("background", "#000").style("color", "#fff")
                    dams2();
                })

            d3.select(".three")
                .on("click", function () {
                    d3.selectAll(".dam").style("background", "#fff").style("color", "#000")
                    d3.select(this).style("background", "#000").style("color", "#fff")
                    dams3();
                })

            d3.select(".four")
                .on("click", function () {
                    d3.selectAll(".dam").style("background", "#fff").style("color", "#000")
                    d3.select(this).style("background", "#000").style("color", "#fff")
                    dams4();
                })









            } // END OF MAIN FUNCTION





    queue()
        .defer(d3.csv, 'data/all_dams.csv')
        .defer(d3.csv, 'data/provinces.csv')
        .defer(d3.csv, 'data/all_dams_size.csv')
        .defer(d3.csv, 'data/all_dams_alpha.csv')
        .await(main);












    </script>


    <!-- END DAMS STATS -->


    <!-- KEY DAMS -->

    <script>

      var damColors =
//          ["#eee", "#a5a5a5", "#eee", "#a5a5a5", "#eee", "#a5a5a5", "#eee", "#a5a5a5", "#eee", "#a5a5a5", "#eee", "#a5a5a5"];
        ["#b9b6cb","#abd8bc","#e5a2af","#9dd0dc","#e6b8a6","#a5a5a5","#cac4a1","#dbb7e0","#e1e8d0","#ebb9c7","#e1daec","#d9c0c7"]

      var width = $("#keydams").width() ;




        d3.csv("data/fiftypercent.csv", function (topten) {



         var key_svg = d3.select("#keydams")
            .append("svg")
            .attr("width", width)
            .attr("height", 150)
            .append("g")


        var keyx = d3.scale.linear()
            .range([0,width])

        var top_ten = topten.filter( function (d) { return d.dam !== "Total"; });
        keyx.domain([0,topten[6].fsc])



        xPos2 = 0;
        yPos2 = 30;

        top_ten.forEach( function (d,i) {



            d.fsc = +d.fsc;



            key_svg.append("rect")
                .attr("class", "barscont")
                .attr("width", function () { return keyx(d.fsc); })
                .attr("height", 20)
                .attr("x", xPos2)
                .attr("y", 60)
                .style("fill", damColors[i])
                .classed("bars" + i, true)
                .on("click", function () {

                    d3.select(this)
                        .style("stroke","#000")


                    keylabels.html("<b>" + d.dam + "</b>:<br /> " + d.fsc + " million cubic meters")

                })
                .on("mouseover", function () {

                    d3.select(this)
                        .style("stroke","#000")


                    keylabels.html("<b>" + d.dam + "</b>:<br /> " + d.fsc + " million cubic meters")

                })
                .on("mouseout", function () {

                d3.select(this)
                        .style("stroke","none")
//                    d3.select(".info" + i)
//                        .style("background", "#fff")
//
//                    d3.select(this)
//                        .style("stroke","none")
//
//                    d3.select(".dam" + i)
//                        .style("fill", "teal")
//                        .attr("r", 5)
//
//                    damtooltip.style("visibility","hidden")

                })



            key_svg.append("text")
                .attr("x", function () {
                    return ((keyx(d.fsc))/2) + xPos2;
                })
                .attr("y", yPos2)
                .style("text-anchor","middle")
                .text( function () {
//                    var dam = (d.dam).replace("Dam","");
                    return d.percent + "%";

                                  })
                .style("stroke", "none")
                .style("fill","#000")
                .style("font-size","0.7em")
                .style("font-weight","bold")

                .attr("class","damlabels")
                .style("shape-rendering", "crispEdges")






             key_svg.append("line")
                .attr("x1", function () {
                    return ((keyx(d.fsc))/2) + xPos2;
                })
                .attr("x2", function () {
                    return ((keyx(d.fsc))/2) + xPos2;
                })
                .attr("y1", yPos2 + 5 )
                .attr("y2", 70)
                .style("stroke", "#444")
                .style("stroke-width", 1)
                .style("shape-rendering", "crispEdges")

             key_svg.append("circle")
                .attr("cx", function () {
                    return ((keyx(d.fsc))/2) + xPos2;
                })
                .attr("cy", 70)
                .attr("r", 2)
                .style("fill", "#444")

             if(i == 5) {

              key_svg.append("text")
                .attr("x", function () {
                    return ((keyx(d.fsc))/2) + xPos2;
                })
                .attr("y", 110)
                .style("text-anchor","middle")
                .text( "All Other Dams")
                .style("stroke", "none")
                .style("fill","#000")
                .style("font-size","0.8em")
                .style("font-weight","bold")

                .attr("class","damlabels")
                .style("shape-rendering", "crispEdges")

             }




//
//
//

             if(yPos2 == 30){ yPos2 = 45; }
            else { yPos2 = 30; }
//            yPos2 += 10;
             xPos2 += keyx(d.fsc);
//
        })

        // ADD CLICK LABELS
            var keylabels = key_svg.append("foreignObject")
                .attr("x", 20)
                .attr("y",90)
//                .style("text-anchor","left")

//                .style("stroke", "none")
//                .style("fill","#000")
//                .style("font-size","0.8em")
//                .style("font-weight","bold")


                .attr("class","damlabels2")
                .style("shape-rendering", "crispEdges")


        })



    </script>

    <!-- END KEY DAMS -->


    <!-- LARGEST DAMS -->
    <script>
        var lastDrainage = "";
        var mapwidth = $("#map").width();

        if(mapwidth < 400) {
            var mapheight = mapwidth ;
            var zoom = 4;
        }
        else if(mapwidth < 800) {

            var mapheight = mapwidth ;
            var zoom = 6;
        }
        else {
//            mapwidth = 600;
            var mapheight = mapwidth * 0.6;
            var zoom = 6;
        }

        $("#map").height(mapheight);
        $("#map").width(mapwidth);





        function highlightFeature(e) {

            var layer = e.target;


            var drainage = e.target.feature.properties.region;
            lastDrainage = drainage;


//            d3.select("#feature-" + drainage).style("fill","dodgerblue");

            var popupContent = "<div class='popup'><div class='popuptitle'>" + e.target.feature.properties.dam + "</div>";
            popupContent += "" + e.target.feature.properties.fsc + " million cubic meters<br />";
            popupContent += "Drainage region " + e.target.feature.properties.region
            popupContent += "</div>";


            var customOptions =
                {
                'maxWidth': '800',
                'width': '500',
                'className' : 'popupCustom'
                }



		layer.bindPopup(popupContent, customOptions);
            this.openPopup();

        }

        function resetHighlight(e) {


        }



        function onEachFeature(feature, layer) {
            layer.on({
                mouseover: highlightFeature,
//                mouseout: resetHighlight,
                click: highlightFeature
//                mousemove: tooltipMove
            });
        }



    var mymap = L.map('map').setView([-30.550938,25.3868996], zoom);

//       L.tileLayer('http://stamen-tiles-{s}.a.ssl.fastly.net/toner-background/{z}/{x}/{y}.{ext}', {
//	attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
//	subdomains: 'abcd',
//	minZoom: 0,
//	maxZoom: 20,
//	ext: 'png'
//}).addTo(mymap);


//        L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/light-v9/tiles/256/{z}/{x}/{y}?access_token={accessToken}', {
//        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',
//        maxZoom: 20,
//        id: 'alastairotter.07i8pfkj',
//        accessToken: 'pk.eyJ1IjoiYWxhc3RhaXJvdHRlciIsImEiOiJjaWc1NjM1dGYwYXV6djJtNjc5dGNqZThrIn0.SWLrLlYJWBdLvyIURec3FA'
//
//        }).addTo(mymap);

        mymap.scrollWheelZoom.disable();


    // ADD SA BOUNDARIES
        var geoJsonLayer = L.geoJson(sabounds, {


        style: function (feature) {


            return {
                weight: 1,
                fillOpacity: 1,
                fillColor: "#fff",
                color:"gray"

            }
        }

    }).addTo(mymap);

    // ADD DRAINAGE AREAS

    var geoJsonLayer = L.geoJson(drainage, {


        style: function (feature) {

            if(feature.properties.id === "C") {
                var col = "#c67575";
            }
            else if(feature.properties.id === "W") {
                var col = "#a5c6a6";
            }
            else if(feature.properties.id === "D") {
                var col = "#bccfe0";
            }
            else if(feature.properties.id === "H") {
                var col = "#d8c595";
            }

            else {
                var col = "none";
            }
            return {
                weight: 1,
                fillOpacity: 0.3,
                fillColor: col,
                color:"none"

            }
        }

    }).addTo(mymap);

        geoJsonLayer.eachLayer(function (layer) {
    layer._path.id = 'feature-' + layer.feature.properties.id;
});


    L.geoJson(toptenjson, {

		style: function (feature) {
			return feature.properties && feature.properties.style;
		},

		onEachFeature: onEachFeature,

		pointToLayer: function (feature, latlng) {

            if(feature.properties.region === "C") {
                var col = "crimson";

            }
            else if(feature.properties.region === "W") {
                var col = "crimson";
            }
            else if(feature.properties.region === "D") {
                var col = "crimson";
            }
            else if(feature.properties.region === "H") {
                var col = "crimson";
            }
            else {
                var col = "yellow";
            }
			return L.circleMarker(latlng, {
				radius: 10,
				fillColor: col,
				color: "gray",
				weight: 1,
				opacity: 1,
				fillOpacity: 1
			});
		}
	}).addTo(mymap);







    </script>
    <!-- END LARGEST DAMS -->






    <!-- WC DAMS -->

    <script>

        var oldest = 136;
        var ageColors = ['#ffffd9','#edf8b1','#c7e9b4','#7fcdbb','#41b6c4','#1d91c0','#225ea8','#253494','#081d58'];

        var mapwidth = $("#map2").width();

        if(mapwidth < 400) {
            var mapheight = mapwidth * 0.6;
            var zoom = 9;
        }
        else if(mapwidth < 800) {
            var mapheight = mapwidth * 0.5;
            var zoom = 8;
        }
        else {
            var mapheight = mapwidth * 0.5;
            var zoom = 9;
        }

        $("#map2").height(mapheight);





        function highlightFeature(e) {

            var layer = e.target;


            var drainage = e.target.feature.properties.region;
//            d3.select("#feature-" + drainage).style("fill","dodgerblue");

            var popupContent = "<div class='popup'><div class='popuptitle'>" + e.target.feature.properties.dam + "</div>";
            popupContent += "Full capacity: " + e.target.feature.properties.fsc  + " million cubic meters<br />";
            popupContent += "27 Feb 2017: <span class='bold'>" + e.target.feature.properties.this_week + "%</span> <br/>";
//            popupContent += "Last week: <span class='bold'>" + e.target.feature.properties.last_week + "%</span> <br />";
            popupContent += "Last year: <span class='bold'>" + e.target.feature.properties.last_year + "%</span> <br />";
            popupContent += "</div>";


            var customOptions =
                {
                'maxWidth': '800',
                'width': '500',
                'className' : 'popupCustom'
                }


		layer.bindPopup(popupContent, customOptions);
            this.openPopup();

        }



        function onEachFeature(feature, layer) {
            layer.on({
                mouseover: highlightFeature,
//                mouseout: resetHighlight,
                click: highlightFeature
//                mousemove: tooltipMove
            });
        }

    //

    var mymap2 = L.map('map2').setView([-33.79807,19.226820], zoom);


  L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}', {
	attribution: 'Tiles &copy; Esri &mdash; Source: Esri, DeLorme, NAVTEQ, USGS, Intermap, iPC, NRCAN, Esri Japan, METI, Esri China (Hong Kong), Esri (Thailand), TomTom, 2012'
}).addTo(mymap2);



        mymap2.scrollWheelZoom.disable();

// ADD DRAINAGE AREAS
        var geoJsonLayer = L.geoJson(wcdrainage, {


        style: function (feature) {

            if(feature.properties.id === "H") {
                var col = "crimson";
            }
            else if(feature.properties.id === "G") {
                var col = "dodgerblue";
            }


            else {
                var col = "none";
            }
            return {
                weight: 1,
                fillOpacity: 0.3,
                fillColor: col,
                color:"none"

            }
        }

    }).addTo(mymap2);

        geoJsonLayer.eachLayer(function (layer) {
    layer._path.id = 'feature-' + layer.feature.properties.id;
});

// ADD DRAINAGE AREAS

    L.geoJson(wcdams, {

		style: function (feature) {
			return feature.properties && feature.properties.style;
		},

		onEachFeature: onEachFeature,

		pointToLayer: function (feature, latlng) {
            var col = Math.round((feature.properties.age/136)*10);

            if(feature.properties.region==="H") {
                var col = "crimson";
            }
            else if(feature.properties.region === "G") {
                    var col = "dodgerblue";

            }

			return L.circleMarker(latlng, {
				radius:8,
				fillColor: col,
				color: "#fff",
                stroke: 5,
				weight: 2,
				opacity: 1,
				fillOpacity: 1,
                class: "damPoint"
			});
		}
	}).addTo(mymap2);







    </script>

    <script>
//    var cookie = document.getCookie("sawater");
//        console.log(cookie);
//        if(cookie === "true") {
////            document.setCookie('sawater', 'false');
//
//        }
//        else {
////            document.setCookie("sawater", "true");
//        }
//
//        $(".check").click( function () {
//            $(".splash").css("display", "none");
//            document.setCookie("sawater", "true");
//        })

    </script>



    <script>
//        $("document").ready( function () {
//
//
//            if(cookie !== "true" && window.innerWidth < 800) {
//
//                $(".splash").css("display","block")
//
//            }
//
//
//
//        });
    </script>

<!--
<script>

    $(window).scroll(function(i){
        var scrollVar = $(window).scrollTop();
        $('.info-pane').css({'opacity':( 200-scrollVar)/200});
        $('.info').css({'opacity':( -200-scrollVar)/200});
//        $('.info-pane-share').css({'opacity':( 200-scrollVar)/200});
    });

</script>
-->

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-72472423-1', 'auto');
ga('send', 'pageview');

</script>  

<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4d708b425b845fd3"></script>
</body>
</html>
